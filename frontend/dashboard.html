<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - TravelExpense</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --white: #ffffff;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: var(--gray-50);
            color: var(--gray-900);
        }

        .layout {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--white);
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .user-info {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 0.5rem;
        }

        .user-name {
            font-weight: 600;
            color: var(--gray-900);
        }

        .user-role {
            font-size: 0.875rem;
            color: var(--gray-500);
            margin-top: 0.25rem;
        }

        .user-company {
            font-size: 0.75rem;
            color: var(--gray-400);
            margin-top: 0.25rem;
        }

        .nav {
            flex: 1;
            padding: 1rem 0;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section-title {
            padding: 0 1.5rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-400);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--gray-600);
            text-decoration: none;
            transition: all 0.2s;
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--gray-50);
            color: var(--gray-900);
        }

        .nav-item.active {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
            border-right: 3px solid var(--primary);
        }

        .nav-item i {
            width: 20px;
            margin-right: 0.75rem;
        }

        .sidebar-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--gray-200);
        }

        .logout-btn {
            width: 100%;
            padding: 0.75rem;
            background: var(--gray-100);
            color: var(--gray-600);
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: var(--gray-200);
        }

        /* Main Content */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            padding: 1rem 2rem;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            margin-left: auto;
        }

        .btn {
            padding: 0.5rem 1rem;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--gray-100);
            color: var(--gray-700);
        }

        .btn-secondary:hover {
            background: var(--gray-200);
        }

        .content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--white);
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-200);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-title {
            font-weight: 600;
            color: var(--gray-900);
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .stat-card .card-icon {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--gray-500);
            font-size: 0.875rem;
        }

        .stat-change {
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--error);
        }

        /* Travel List */
        .travel-list {
            background: var(--white);
            border-radius: 0.75rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-200);
            margin-top: 1rem;
        }

        /* Main focus travel table for employees */
        #employee-travel-table {
            margin-top: 0;
        }

        .travel-list-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .travel-list-title {
            font-weight: 600;
            color: var(--gray-900);
        }

        .travel-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-100);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.2s;
        }

        .travel-item:hover {
            background: var(--gray-50);
        }

        .travel-item:last-child {
            border-bottom: none;
        }

        .travel-info h3 {
            font-weight: 500;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .travel-meta {
            font-size: 0.875rem;
            color: var(--gray-500);
        }

        .travel-status {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-draft {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .status-submitted {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .status-approved {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .status-rejected {
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1.5rem;
            color: var(--gray-500);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--gray-300);
        }

        /* Team overview styles */
        .team-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.5rem;
        }

        .expense-amount {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 0.875rem;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        /* Page sections */
        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .layout {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                order: 2;
            }

            .main {
                order: 1;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .quick-action {
            background: var(--white);
            border: 2px dashed var(--gray-200);
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.2s;
            cursor: pointer;
            text-decoration: none;
            color: var(--gray-600);
        }

        .quick-action:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .quick-action i {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            display: block;
        }

        /* Team Overview Styles */
        .team-table-container {
            background: var(--white);
            border-radius: 0.5rem;
            border: 1px solid var(--gray-200);
            overflow: hidden;
            margin-top: 1rem;
        }

        .team-table {
            width: 100%;
            border-collapse: collapse;
        }

        .team-table th {
            background: var(--gray-50);
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            color: var(--gray-900);
            border-bottom: 1px solid var(--gray-200);
        }

        .team-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--gray-100);
            vertical-align: middle;
        }

        .team-table tbody tr:hover {
            background: var(--gray-50);
        }

        .employee-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .employee-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .employee-details .name {
            font-weight: 500;
            color: var(--gray-900);
        }

        .employee-details .email {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .department-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .department-sales { background: rgba(239, 68, 68, 0.1); color: var(--error); }
        .department-marketing { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .department-development { background: rgba(37, 99, 235, 0.1); color: var(--primary); }
        .department-hr { background: rgba(245, 158, 11, 0.1); color: var(--warning); }

        .team-actions {
            display: flex;
            gap: 0.5rem;
        }

        .team-actions .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 0.25rem;
        }

        .expense-amount {
            font-weight: 600;
            color: var(--gray-900);
        }

        .expense-budget {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }

        .btn-warning {
            background: var(--warning);
            color: var(--white);
        }

        .btn-warning:hover {
            background: #d97706;
        }
    </style>
</head>
<body>
    <div class="layout">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">TravelExpense</div>
                <div class="user-info">
                    <div class="user-name" id="user-name">Max Mustermann</div>
                    <div class="user-role" id="user-role">Mitarbeiter</div>
                    <div class="user-company" id="user-company">Demo GmbH</div>
                </div>
            </div>

            <nav class="nav">
                <div class="nav-section">
                    <div class="nav-section-title">Hauptmenü</div>
                    <a class="nav-item active" onclick="showPage('dashboard')">
                        <i class="fas fa-home"></i>
                        Dashboard
                    </a>
                    <a class="nav-item" onclick="showPage('travels')" id="meine-reisen-nav">
                        <i class="fas fa-plane"></i>
                        Meine Reisen
                    </a>
                    <a class="nav-item" onclick="showPage('receipts')" id="belege-nav">
                        <i class="fas fa-receipt"></i>
                        Belege
                    </a>
                </div>

                <div class="nav-section" id="admin-section" style="display: none;">
                    <div class="nav-section-title">Administration</div>
                    <a class="nav-item" href="/api/v1/admin">
                        <i class="fas fa-users-cog"></i>
                        Admin Dashboard
                    </a>
                    <a class="nav-item" onclick="showPage('user-management')">
                        <i class="fas fa-user-cog"></i>
                        User Management
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Verwaltung</div>
                    <a class="nav-item" onclick="showPage('profile')">
                        <i class="fas fa-user"></i>
                        Profil
                    </a>
                    <a class="nav-item" onclick="showPage('settings')">
                        <i class="fas fa-cog"></i>
                        Einstellungen
                    </a>
                </div>
            </nav>

            <div class="sidebar-footer">
                <button class="logout-btn" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Abmelden
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main">
            <header class="header">
                <h1 id="page-title">Dashboard</h1>
                <div class="header-actions">
                    <a href="travel-form-start.html" class="btn" id="neue-reise-button">
                        <i class="fas fa-plus"></i>
                        Neue Reise
                    </a>
                </div>
            </header>

            <main class="content">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page-section active">
                    <!-- Employee Travel Table - Main Focus -->
                    <div class="travel-list" id="employee-travel-table">
                        <div class="travel-list-header">
                            <div class="travel-list-title">Meine Reisen</div>
                            <a href="#" onclick="exportAllTravelsPDF()" class="btn btn-secondary">
                                <i class="fas fa-file-pdf"></i> Als PDF exportieren
                            </a>
                        </div>
                        <div class="team-table-container">
                            <table class="team-table">
                                <thead>
                                    <tr>
                                        <th>Reiseziel</th>
                                        <th>Datum</th>
                                        <th>Status</th>
                                        <th>Gesamtkosten</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="travel-table-body">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Controller Team Overview -->
                    <div class="travel-list" id="controller-overview" style="display: none;">
                        <div class="travel-list-header">
                            <div class="travel-list-title">Team-Übersicht & Ausgaben YTD</div>
                        </div>
                        
                        <!-- Team Members Table -->
                        <div class="team-table-container">
                            <table class="team-table" id="team-table">
                                <thead>
                                    <tr>
                                        <th>Mitarbeiter</th>
                                        <th>Abteilung</th>
                                        <th>Aktive Reisen</th>
                                        <th>YTD Ausgaben</th>
                                        <th>Zur Freigabe</th>
                                        <th>Aktionen</th>
                                    </tr>
                                </thead>
                                <tbody id="team-table-body">
                                    <!-- Will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Other pages will be added here -->
                <div id="travels-page" class="page-section">
                    <h2>Meine Reisen</h2>
                    <p>Hier werden alle Ihre Reisen angezeigt...</p>
                </div>

                <div id="receipts-page" class="page-section">
                    <h2>Belege verwalten</h2>
                    <p>Hier können Sie Ihre Belege verwalten...</p>
                </div>

                <div id="profile-page" class="page-section">
                    <h2>Profil</h2>
                    <p>Hier können Sie Ihr Profil bearbeiten...</p>
                </div>
            </main>
        </div>
    </div>

    <script>
        // User management
        let currentUser = null;

        function initUser() {
            const userData = localStorage.getItem('user');
            const token = localStorage.getItem('token');
            
            console.log('Raw userData from localStorage:', userData); // Enhanced debug
            console.log('Token from localStorage:', token ? 'Present' : 'Missing'); // Enhanced debug
            
            if (!userData || !token) {
                console.log('Missing authentication data, redirecting to login');
                window.location.href = '/';
                return;
            }

            currentUser = JSON.parse(userData);
            console.log('Parsed currentUser object:', currentUser); // Enhanced debug
            console.log('Role type:', typeof currentUser.role, 'Role value:', currentUser.role); // Enhanced debug
            
            // Redirect admins to admin dashboard
            if (currentUser.role === 'admin') {
                console.log('Admin user detected, redirecting to admin dashboard');
                window.location.href = '/api/v1/admin';
                return;
            }
            
            document.getElementById('user-name').textContent = currentUser.name;
            document.getElementById('user-company').textContent = currentUser.company;
            
            const roleText = currentUser.role === 'controller' ? 'Controlling' : 'Mitarbeiter';
            document.getElementById('user-role').textContent = roleText;

            // Show role-specific UI elements
            console.log('User role:', currentUser.role); // Debug line
            console.log('Role comparison result:', currentUser.role === 'controller'); // Enhanced debug
            if (currentUser.role === 'controller') {
                console.log('Setting up controller UI'); // Debug line
                // Show controller sections
                document.getElementById('controller-overview').style.display = 'block';
                
                // Hide employee sections
                document.getElementById('employee-travel-table').style.display = 'none';
                
                // Hide employee navigation and buttons
                document.getElementById('neue-reise-button').style.display = 'none';
                document.getElementById('meine-reisen-nav').style.display = 'none';
                document.getElementById('belege-nav').style.display = 'none';
                
                // Load controller-specific data
                loadTeamOverview();
            } else {
                console.log('Setting up employee UI'); // Debug line
                // Show employee sections - main travel table
                document.getElementById('employee-travel-table').style.display = 'block';
                
                // Show employee navigation and buttons
                document.getElementById('neue-reise-button').style.display = 'block';
                document.getElementById('meine-reisen-nav').style.display = 'block';
                document.getElementById('belege-nav').style.display = 'block';
                
                // Hide controller sections
                document.getElementById('controller-overview').style.display = 'none';
                
                // Load employee-specific data
                loadTravels();
            }
        }

        // Page navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });

            // Show selected page
            document.getElementById(pageId + '-page').classList.add('active');

            // Update nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'travels': 'Meine Reisen',
                'receipts': 'Belege',
                'profile': 'Profil',
                'settings': 'Einstellungen'
            };
            document.getElementById('page-title').textContent = titles[pageId] || 'Dashboard';
        }

        // Load travel data
        async function loadTravels() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    console.error('No authentication token found');
                    window.location.href = '/';
                    return;
                }

                const response = await fetch('http://localhost:8000/api/v1/travels/', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 401) {
                        // Token expired or invalid
                        localStorage.removeItem('token');
                        localStorage.removeItem('user');
                        window.location.href = '/';
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const travels = await response.json();
                displayTravelTable(travels); 
            } catch (error) {
                console.error('Error loading travels:', error);
                displayTravelTable([]); // Show empty table
            }
        }

        function displayTravelTable(travels) {
            const container = document.getElementById('travel-table-body');
            if (!travels || travels.length === 0) {
                container.innerHTML = `<tr><td colspan="5"><div class="empty-state"><h3>Noch keine Reisen</h3><p>Erstellen Sie Ihre erste Geschäftsreise</p></div></td></tr>`;
                return;
            }

            container.innerHTML = travels.map(travel => `
                <tr>
                    <td>
                        <strong>${travel.destination_city}, ${travel.destination_country}</strong>
                        <div class="travel-meta">${travel.purpose}</div>
                    </td>
                    <td>${formatDate(travel.start_at)} - ${formatDate(travel.end_at)}</td>
                    <td><span class="travel-status status-${travel.status}">${getStatusText(travel.status)}</span></td>
                    <td><strong>€${(travel.total_expenses || 0).toFixed(2)}</strong></td>
                    <td>
                        <button class="btn btn-sm" onclick="viewTravelDetails(${travel.id})"><i class="fas fa-eye"></i></button>
                        <button class="btn btn-sm btn-secondary" onclick="exportTravelPDF(${travel.id})"><i class="fas fa-file-pdf"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function viewTravelDetails(travelId) {
            alert(`Details für Reise ${travelId} anzeigen.`);
        }

        function exportTravelPDF(travelId) {
            alert(`PDF für Reise ${travelId} exportieren.`);
        }
        
        function exportAllTravelsPDF() {
            alert('Alle Reisen als PDF exportieren.');
        }

        // Controller-specific functions
        async function loadTeamOverview() {
            try {
                // Fetch real employee data from the API
                const token = localStorage.getItem('token');
                if (!token) {
                    console.error('No authentication token found');
                    showTeamEmptyState();
                    return;
                }

                const response = await fetch('/api/v1/users/my-team', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const employees = await response.json();
                
                // Transform API data to match the expected format for the table
                const teamMembers = employees.map(emp => ({
                    id: emp.id,
                    name: emp.name,
                    email: emp.email,
                    department: emp.department || 'general',
                    activeTravels: 0, // TODO: This should come from travel data
                    ytdExpenses: 0,   // TODO: This should come from travel expense data  
                    yearBudget: 20000, // TODO: This should come from user budget data
                    pendingApprovals: 0, // TODO: This should come from travel approval data
                    status: 'active'
                }));
                
                displayTeamTable(teamMembers);
            } catch (error) {
                console.error('Error loading team data:', error);
                showTeamEmptyState();
            }
        }

        function displayTeamTable(teamMembers) {
            const tableBodyHtml = teamMembers.map(member => {
                return `
                    <tr>
                        <td>
                            <div class="employee-info">
                                <div class="employee-avatar">${member.name.split(' ').map(n => n[0]).join('')}</div>
                                <div class="employee-details">
                                    <div class="name">${member.name}</div>
                                    <div class="email">${member.email}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="department-badge department-${member.department}">
                                ${getDepartmentName(member.department)}
                            </span>
                        </td>
                        <td>${member.activeTravels}</td>
                        <td>
                            <div class="expense-amount">€${member.ytdExpenses.toLocaleString()}</div>
                            <div class="expense-budget">von €${member.yearBudget.toLocaleString()}</div>
                        </td>
                        <td>
                            ${member.pendingApprovals > 0 ? 
                                `<span class="badge badge-warning">${member.pendingApprovals}</span>` : 
                                '<span class="badge badge-success">0</span>'
                            }
                        </td>
                        <td>
                            <div class="team-actions">
                                <button class="btn btn-sm" onclick="viewMemberDetails(${member.id})">
                                    <i class="fas fa-eye"></i> Details
                                </button>
                                ${member.pendingApprovals > 0 ? 
                                    `<button class="btn btn-sm btn-warning" onclick="reviewApprovals(${member.id})">
                                        <i class="fas fa-check"></i> Prüfen
                                    </button>` : ''
                                }
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('team-table-body').innerHTML = tableBodyHtml;
        }

        function getDepartmentName(dept) {
            const departments = {
                'sales': 'Vertrieb',
                'marketing': 'Marketing', 
                'development': 'Entwicklung',
                'hr': 'HR'
            };
            return departments[dept] || dept;
        }

        function viewMemberDetails(memberId) {
            alert(`Viewing details for member ID: ${memberId}`);
        }

        function reviewApprovals(memberId) {
            alert(`Reviewing approvals for member ID: ${memberId}`);
        }

        function showTeamEmptyState() {
            document.getElementById('team-table-body').innerHTML = `
                <tr>
                    <td colspan="6" class="text-center">
                        <div class="empty-state" style="padding: 2rem;">
                            <i class="fas fa-users" style="font-size: 2rem; color: var(--gray-400); margin-bottom: 1rem;"></i>
                            <h3 style="color: var(--gray-600); margin-bottom: 0.5rem;">Keine Mitarbeiter zugewiesen</h3>
                            <p style="color: var(--gray-500);">Ihnen wurden noch keine Mitarbeiter zugewiesen.</p>
                        </div>
                    </td>
                </tr>
            `;
        }

        function getTeamStatusText(status) {
            const statusMap = {
                'active': 'Aktiv',
                'pending': 'Zur Prüfung',
                'approved': 'Genehmigt'
            };
            return statusMap[status] || status;
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('de-DE');
        }

        function getStatusText(status) {
            const statusMap = {
                'draft': 'Entwurf',
                'submitted': 'Eingereicht',
                'approved': 'Genehmigt',
                'rejected': 'Abgelehnt'
            };
            return statusMap[status] || status;
        }

        function logout() {
            localStorage.removeItem('user');
            localStorage.removeItem('token');
            window.location.href = '/';
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            initUser();
        });
    </script>
</body>
</html>
